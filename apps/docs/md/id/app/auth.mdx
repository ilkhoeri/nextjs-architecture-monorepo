---
title: Auth Page
---

# Halaman Otorisasi

---

<br />

<Img src="/assets/images/diagram-flow-auth-solid.png" alt="auth-flow" className="left-1/2 -translate-x-1/2 w-full xl:max-w-[80%]" />
<small>Illustration â€“ Authentication Flow (Server RSC)</small>

---

<blockquote data-quote="">
  Aplikasi telah merekam beberapa akun dummy aktif yang dapat digunakan sebagai preview aplikasi.
  <br />
  <a href="/assets/dummy/test.user.json" className="-mt-4">
    â• Lihat daftar akun
  </a>
  <a href="/assets/dummy/test.user.json" download="test.user.json">
    â• Download daftar akun
  </a>
</blockquote>

Rute `auth` adalah rute utama yang digunakan dalam pengelolaan kredensial pengguna. Di dalamnya terdapat serangkaian alur halaman penting seperti `sign in`, `sign up`, `invitation`, `verification`, dan `error`, yang dirancang untuk menangani berbagai skenario autentikasi.

Kredensial dikelola menggunakan [NextAuth](https://authjs.dev/), yang menyediakan dukungan berbagai jenis provider serta kemampuan penuh untuk kustomisasi alur autentikasi.

**React Server Components (RSC)** mulai didukung secara penuh sejak **React 18**, dan diadopsi sepenuhnya oleh Next.js melalui **Next.js 13.4** bersamaan dengan peluncuran **App Router**. Oleh karena itu, seluruh aktivitas kredensial diimplementasikan menggunakan fungsi dengan direktif `"use server"`. Ini memungkinkan fungsi dijalankan sepenuhnya di sisi server, menjaga visibilitas dan keamanan internal, serta menghindari pendekatan tradisional menggunakan API handler. Pendekatan ini tetap dapat dikombinasikan dengan client-side interactivity menggunakan `use client`.

Referensi: [React.js RSC](https://react.dev/reference/rsc/use-client), [Next.js use-server](https://nextjs.org/docs/app/api-reference/directives/use-server).

<h4 className="text-h3 font-bold">Pertimbangan teknis:</h4>

- **Efektivitas hasil**: Baik menggunakan endpoint API maupun server handler, hasil akhir tetap identik. Namun pendekatan server handler menawarkan efisiensi eksekusi lebih tinggi.
- **Sesi tunggal (single-app session)**: Karena sesi hanya digunakan dalam satu aplikasi dan tidak dibagikan lintas aplikasi, maka tidak diperlukan public endpoint API untuk autentikasi.
- **Waktu buffer (buffering time)**: Berdasarkan berbagai skenario pengujian, penggunaan server handler menghasilkan waktu transaksi yang lebih cepat pada aksi seperti `like`, `save`, `follow`, dan `credential handling`.

<br />

## Masuk

---

Halaman `sign-in` digunakan untuk login ke dalam sistem. Di sini, saya hanya menyediakan autentikasi manual (username/email + password), bukan melalui third-party providers seperti `Google`, `Apple`, `GitHub`, dll. Alasan utamanya adalah:

- Kredensial manual memberikan keleluasaan pengguna dalam memilih nama akun dan password.
- Konfigurasi provider membutuhkan setup tambahan di akun perusahaan, termasuk biaya tambahan untuk tracking.

Namun, jika diperlukan, kredensial provider dapat dengan mudah diaktifkan karena dukungannya sudah disiapkan dalam struktur aplikasi.

```tsx
function LoginWithProviders() {
  const providers = [
    { name: "google", icon: GoogleIcon },
    { name: "github", icon: GithubIcon }
  ];

  return (
    <Wrapper>
      <Header>
        <Title>Or continue with</Title>
      </Header>
      <Content>
        {providers.map(provider => (
          <Button key={provider.name} onClick={() => signIn(provider.name, { callbackUrl: "/" })}>
            <provider.icon className="mr-2 size-5" />
            Login with {transform(provider.name)}
          </Button>
        ))}
      </Content>
    </Wrapper>
  );
}
```

### Form Eksekusi

- **Identifier Field** <br />
  Field `Enter Username/Email` mendukung deteksi otomatis jenis input (username atau email) melalui sebuah fungsi identifikasi sederhana.

```ts
function isEmail(identifier: string): boolean;
```

Fungsi ini memverifikasi apakah input sesuai format email. Jika tidak, akan dianggap sebagai username.

- **Pencarian User** <br />
  Berdasarkan hasil identifikasi:

```ts
function getUserByEmail(email: string): Promise<Account | null>;
function getUserByUserName(username: string): Promise<Account | null>;
```

Kedua fungsi ini dibungkus dalam satu fungsi agregat:

```ts
function getUserByIdentifier(identifier: string): Promise<Account | null>;
```

Fungsi ini mencari akun berdasarkan `email` atau `username` secara unik. Setelah akun ditemukan, login akan tetap dilakukan menggunakan `email` dari akun tersebut. _Note: email dan username harus unik antar pengguna._

- **Password Field** <br />
  Fitur ini mencakup:
  - Toggle visibilitas (`show/hide`) <br />
    Pengguna dapat menyembunyikan atau menampilkan password sesuai kebutuhan (default: `hide`).
  - Validasi real-time: <br />
    Komponen `<Dropdown>` akan muncul ketika pengguna mulai mengisi kolom password. <br />
    Validasi meliputi: <br />
    1. Panjang karakter
    2. Huruf besar
    3. Huruf kecil
    4. Angka, dan
    5. Karakter khusus.
  - Hashing <br/>
    Password yang telah tervalidasi akan dikirim ke sisi server dalam format yang sudah di hashing. Hashing password menggunakan [bcrypt.js](https://www.npmjs.com/package/bcryptjs).

- **Login Button** <br />
  Tombol login tidak aktif secara default hingga semua field terisi. Setelah valid, tombol akan aktif dengan animasi transisi warna.

- **Reset Password** <br />
  Fitur ini memungkinkan pengguna untuk mengatur ulang password melalui email. Form `Reset Password` muncul sebagai inline form pada halaman yang sama (`/auth/sign-in`) tanpa navigasi. Form hanya memerlukan email untuk mengirim OTP menggunakan layanan seperti Resend. <br />
  _Catatan: Saat ini tombol ini bersifat placeholder._

- **Register Here** <br />
  Tombol ini mengarahkan pengguna ke `/auth/sign-up`. <br />
  _Catatan: Autentikasi menggunakan provider tidak memerlukan halaman sign-up._

### Skenario Eksekusi

| Request                                              | Response | Handling                                       |
| ---------------------------------------------------- | -------- | ---------------------------------------------- |
| `Username`/`Email` invalid + `Password` tidak sesuai | ğŸ”´       | `toast` â†’ `Invalid input`                      |
| `Username` salah + `Password` benar                  | ğŸ”´       | `toast` â†’ `Password benar, Username not found` |
| `Email` salah + `Password` benar                     | ğŸ”´       | `toast` â†’ `Email not registered`               |
| `Username`/`Email` benar + `Password` salah          | ğŸ”´       | `toast` â†’ `Password is incorrect`              |
| `Username`/`Email` benar + `Password` benar          | ğŸŸ¢       | `toast` â†’ `Login successful`                   |
| `Login successful` + redirect                        | ğŸŸ¢       | `callback` â†’ homepage (atau halaman tujuan)    |

<br />

## Daftar

---

Halaman `/auth/sign-up` digunakan untuk pendaftaran akun baru. Formulir memiliki empat field dan dua tombol aksi.

### Form Eksekusi

- **Email Field** <br />
  Wajib diisi dengan format valid, belum pernah terdaftar.

- **Username Field** <br />
  Harus unik dan minimal 2 karakter. Sistem akan secara otomatis:
  - Menormalisasi username menjadi URL-friendly.
  - Mengisi kolom `name`, `firstName`, dan `lastName` sebagai default.

- **Password Field** <br />
  Mempunyai toggle visibilitas dan validasi real-time.
  - Toggle visibilitas (`show/hide`) <br />
    Pengguna dapat menyembunyikan atau menampilkan password sesuai kebutuhan (default: `hide`).
  - Validasi real-time: <br />
    Komponen `<Dropdown>` akan muncul ketika pengguna mulai mengisi kolom password. <br />
    Validasi meliputi: <br />
    1. Panjang karakter
    2. Huruf besar
    3. Huruf kecil
    4. Angka, dan
    5. Karakter khusus.
  - _Contoh valid:_ `Johndoe123!`

- **Confirm Password Field** <br />
  Digunakan untuk mengkonfirmasi password yang diketik sesuai.

- **Register Button** <br />
  Tombol aktif hanya jika semua field valid. Animasi akan menandakan kesiapan form untuk dikirim.

- **Login Here**
  Navigasi cepat ke halaman login untuk pengguna yang sudah memiliki akun.

### Skenario Eksekusi

| Request                            | Response | Handling                         |
| ---------------------------------- | -------- | -------------------------------- |
| Field tidak sesuai / tidak lengkap | ğŸ”´       | Invalid input                    |
| Email sudah terdaftar              | ğŸ”´       | Email already exists             |
| Username sudah digunakan           | ğŸ”´       | Username already used            |
| Email & username sudah ada         | ğŸ”´       | Email and Username already exist |
| Password tidak sesuai ketentuan    | ğŸ”´       | Error field validation           |
| Semua field valid                  | ğŸŸ¢       | Redirected to `/sign-in`         |

<br />

## Undangan

---

Halaman `/auth/invitation` digunakan untuk memverifikasi token undangan. Cocok untuk akun eksklusif (`beta account`, `promo account`, `special role`) tanpa partisipasi aktif dari pengguna baru.

### Form Eksekusi

- **Token Field** <br />
  Token harus valid, belum digunakan, dan belum kedaluwarsa.

- **Verify Button** <br />
  Tombol hanya aktif jika token diisi.

- **Login Here** <br />
  Alternatif bagi pengguna yang sudah memiliki akun.

### Skenario Eksekusi

| Request                         | Response | Handling                      |
| ------------------------------- | -------- | ----------------------------- |
| Token tidak valid               | ğŸ”´       | Token not registered          |
| Token sudah digunakan           | ğŸ”´       | Token already used            |
| Token kedaluwarsa               | ğŸ”´       | Token has expired             |
| Token melebihi batas penggunaan | ğŸ”´       | Token reached max usage limit |
| Token valid                     | ğŸŸ¢       | Token verified                |
| verified                        | ğŸŸ¢       | Redirected to `/sign-in`      |

<br />

## Verifikasi

---

Halaman `/auth/verification` digunakan dalam proses:

- Two-Factor Authentication (2FA)
- Reset password
- Validasi token email

### Form Eksekusi

- **Token Field** <br />
  Harus diisi dengan token valid yang dikirim via email. <br />
  _Catatan: Hanya untuk email yang sudah terdaftar._
- **Verify Button** <br />
  Tidak aktif sebelum token diisi.

### Skenario Eksekusi

| Request                         | Response | Handling                      |
| ------------------------------- | -------- | ----------------------------- |
| Token tidak valid               | ğŸ”´       | Token not registered          |
| Token sudah digunakan           | ğŸ”´       | Token already used            |
| Token kedaluwarsa               | ğŸ”´       | Token has expired             |
| Token melebihi batas penggunaan | ğŸ”´       | Token reached max usage limit |
| Token valid                     | ğŸŸ¢       | Token verified                |
| verified                        | ğŸŸ¢       | Redirected to callback        |

## Error

---

Halaman `/auth/error` adalah fallback page untuk menangani error seperti token tidak valid atau kedaluwarsa, atau error yang tidak dapat ditangani melalui toast.

### Form Eksekusi

- Tidak ada form pada halaman ini.
- Tidak tersedia aksi lanjutan dari pengguna.

### Skenario Eksekusi

| Response | Handling                                      |
| -------- | --------------------------------------------- |
| ğŸ”´       | Menampilkan status error, tanpa aksi lanjutan |
